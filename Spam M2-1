-- Auto Spam M2 (schedule nhiá»u cá»­a sá»•)
-- DÃ¡n vÃ o executor â€” Ä‘á»™c láº­p, khÃ´ng cáº§n GUI hay code gá»‘c

local FIRE_INTERVAL = 0.65 -- khoáº£ng giá»¯a má»—i láº§n gá»­i (giÃ¢y)
local AUTO_CLEAR = 140     -- â± tá»± Ä‘á»™ng clear script sau X giÃ¢y
local running = true       -- cá» Ä‘iá»u khiá»ƒn Ä‘á»ƒ dá»«ng toÃ n bá»™ thread

-- Danh sÃ¡ch cá»­a sá»•: {start_seconds, end_seconds}
-- Má»—i giÃ¡ trá»‹ lÃ  thá»i Ä‘iá»ƒm tÃ­nh tá»« lÃºc script báº¯t Ä‘áº§u (tick0)
local schedule = {
    {13, 22},    -- báº¯t Ä‘áº§u 13s, káº¿t thÃºc 22s
    {32, 41},    -- báº¯t Ä‘áº§u 32s, káº¿t thÃºc 41s
    {51, 55},    -- báº¯t Ä‘áº§u 51s, káº¿t thÃºc 55s
    {127, 133},  -- báº¯t Ä‘áº§u 127s, káº¿t thÃºc 133s
}

-- ðŸ” tÃ¬m remote: ReplicatedStorage -> BridgeNet2 -> dataRemoteEvent (fallback: tÃ¬m descendants)
local remote
pcall(function()
    local rs = game:GetService("ReplicatedStorage")
    local bridge = rs:FindFirstChild("BridgeNet2")
    if bridge then
        remote = bridge:FindFirstChild("dataRemoteEvent")
    end
    if not remote then
        for _, v in ipairs(rs:GetDescendants()) do
            if v.Name == "dataRemoteEvent" then
                remote = v
                break
            end
        end
    end
end)

-- ðŸ§© bf(): Æ°u tiÃªn buffer.fromstring náº¿u cÃ³, fallback tráº£ chuá»—i
local bf
if type(buffer) == "table" and type(buffer.fromstring) == "function" then
    bf = buffer.fromstring
else
    bf = function(s) return s end
end

local payload_str = "\019\000\000\0000201100101186595482\000"

local function safeFire()
    if not running then return end
    if remote and bf then
        pcall(function()
            remote:FireServer({ { bf(payload_str) }, "\019" })
        end)
    else
        if not safeFire._warned then
            safeFire._warned = true
            warn("[Auto Spam M2] remote hoáº·c bf khÃ´ng kháº£ dá»¥ng; khÃ´ng gá»­i Ä‘Æ°á»£c.")
        end
    end
end

-- ðŸš€ start scheduling
local tick0 = tick()

for i, win in ipairs(schedule) do
    local startT, endT = win[1], win[2]
    if type(startT) ~= "number" or type(endT) ~= "number" or endT <= startT then
        warn(("[Auto Spam M2] Schedule #%d khÃ´ng há»£p lá»‡ (start=%s end=%s) - bá» qua"):format(i, tostring(startT), tostring(endT)))
    else
        task.spawn(function()
            -- chá» Ä‘áº¿n thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u
            local waitUntil = tick0 + startT
            local toWait = waitUntil - tick()
            if toWait > 0 then task.wait(toWait) end
            if not running then return end

            -- náº¿u Ä‘Ã£ vÆ°á»£t quÃ¡ end time, bá» qua
            if tick() >= tick0 + endT then
                warn(("[Auto Spam M2] Schedule #%d Ä‘Ã£ trÃ´i qua trÆ°á»›c khi báº¯t Ä‘áº§u â€” bá» qua."):format(i))
                return
            end

            print(("[Auto Spam M2] Schedule #%d ON (%.1fs -> %.1fs)"):format(i, startT, endT))

            -- spam trong cá»­a sá»•
            while running and tick() < tick0 + endT do
                safeFire()
                task.wait(FIRE_INTERVAL)
            end

            print(("[Auto Spam M2] Schedule #%d OFF (%.1fs)"):format(i, endT))
        end)
    end
end

-- â™»ï¸ AUTO CLEAR TOÃ€N SCRIPT SAU 140 GIÃ‚Y
task.spawn(function()
    task.wait(AUTO_CLEAR)
    running = false
    print(("[Auto Spam M2] ÄÃ£ háº¿t %ds â€” script sáº½ tá»± clear."):format(AUTO_CLEAR))
    pcall(function()
        script:Destroy()
    end)
end)
